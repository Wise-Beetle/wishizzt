<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wishlizzt</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f8f9fa;
    color: #333;
    max-width: 1200px;
    margin: 40px auto;
    padding: 0 20px;
    display: flex;
  }

  /* Sidebar for lists */
  #sidebar {
    width: 200px;
    background-color: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    margin-right: 20px;
  }

  #sidebar h2 {
    font-size: 18px;
    margin-bottom: 10px;
  }

  #listContainer {
    display: flex;
    flex-direction: column;
    gap: 5px;
  }

  .list-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 8px;
    border-radius: 4px;
    cursor: pointer;
    transition: 0.2s;
  }

  .list-item.active {
    background-color: #FFDD99;
    font-weight: bold;
  }

  .list-item:hover {
    background-color: #ffe6b3;
  }

  .list-menu {
    cursor: pointer;
    font-weight: bold;
    padding-left: 5px;
  }

  /* Main content area */
  #mainContent {
    flex: 1;
  }

  h1 {
    text-align: center;
    color: #FF9900;
    margin-bottom: 30px;
  }

  .input-group {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
  }

  .input-group input, .input-group button, .input-group select {
    flex: 1;
    padding: 10px;
    font-size: 16px;
    border-radius: 5px;
    border: 1px solid #ccc;
  }

  .input-group button {
    background-color: #FF9900;
    color: #fff;
    border: none;
    cursor: pointer;
    transition: 0.2s;
  }

  .input-group button:hover {
    background-color: #e68a00;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background-color: #fff;
    border-radius: 8px;
    overflow: hidden;
  }

  th, td {
    text-align: left;
    padding: 12px;
  }

  th {
    background-color: #FF9900;
    color: white;
  }

  tr:nth-child(even) {
    background-color: #f4f4f4;
  }

  tfoot td {
    font-weight: bold;
    background-color: #ffe6b3;
  }

  button.remove-btn {
    background-color: #e74c3c;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    transition: 0.2s;
  }

  button.remove-btn:hover {
    background-color: #c0392b;
  }

  .preview-card {
    display: flex;
    align-items: center;
    background-color: #fff;
    padding: 10px;
    margin-top: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    gap: 15px;
  }

  .preview-card img {
    width: 80px;
    height: 80px;
    object-fit: contain;
    border: 1px solid #ddd;
    border-radius: 4px;
  }

  .preview-card div {
    display: flex;
    flex-direction: column;
  }

  .preview-card a {
    color: #FF9900;
    text-decoration: none;
    font-weight: bold;
  }

  .preview-card a:hover {
    text-decoration: underline;
  }

  @media (max-width: 900px) {
    body {
      flex-direction: column;
      max-width: 600px;
    }

    #sidebar {
      width: 100%;
      margin-bottom: 20px;
    }
  }

  select.qty-dropdown {
    width: 60px;
    padding: 4px;
    font-size: 14px;
  }

  .list-menu {
  position: relative;
  cursor: pointer;
  padding: 0 6px;
  font-weight: bold;
}

.list-tooltip {
  position: absolute;
  right: 0;
  top: 18px;
  background: white;
  border: 1px solid #ddd;
  border-radius: 6px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  z-index: 1000;
  min-width: 120px;
}

.list-tooltip button {
  width: 100%;
  background: none;
  border: none;
  padding: 8px 10px;
  text-align: left;
  cursor: pointer;
  font-size: 14px;
}

.list-tooltip button:hover {
  background-color: #f4f4f4;
}


</style>
</head>
<body>

<div id="sidebar">
  <h2>Lists</h2>
  <div id="listContainer"></div>
  <button id="newListBtn">+ Create New List</button>
</div>

<div id="mainContent">
<h1>WishLizztÂ®</h1>

<!-- Manual input -->
<div class="input-group">
  <input type="text" id="productLink" placeholder="Paste link here">
  <input type="text" id="productName" placeholder="Enter product name">
  <input type="number" id="productPrice" placeholder="Enter price (USD)">
  <input type="number" id="productQuantity" placeholder="Quantity" value="1" min="1">
  <button onclick="addProduct()">Add</button>
</div>

<!-- CSV import/export -->
<div class="input-group">
  <input type="file" id="csvFile" accept=".csv">
  <button id="importBtn">Import CSV</button>
  <button id="exportBtn">Export CSV</button>
</div>

<table>
  <thead>
    <tr>
      <th>Product</th>
      <th>Link</th>
      <th>Price (USD)</th>
      <th>Quantity</th>
      <th>Remove</th>
    </tr>
  </thead>
  <tbody id="wishlistBody"></tbody>
  <tfoot>
    <tr>
      <td colspan="2">Total</td>
      <td id="totalPrice">0.00</td>
      <td id="totalQuantity">0</td>
      <td></td>
    </tr>
  </tfoot>
</table>

<div id="previews"></div>
</div>

<script>
/* ==============================
   Multi-list setup
============================== */
let lists = {}; // { listName: [products] }
let currentList = null;

window.onload = () => {
  const savedLists = localStorage.getItem('wishlistLists');
  const savedCurrent = localStorage.getItem('currentList');

  // Load saved lists if they exist
  if (savedLists) {
    lists = JSON.parse(savedLists);
  }

  const listNames = Object.keys(lists);

  // âœ… If NO lists exist (any reason), create default list
  if (listNames.length === 0) {
    lists['My List'] = [];
    currentList = 'My List';
    saveLists();
  } else {
    // Restore current list or fall back safely
    currentList =
      savedCurrent && lists[savedCurrent]
        ? savedCurrent
        : listNames[0];
  }

  renderListSidebar();
  renderWishlist();
};



/* ==============================
   List functions
============================== */
function createList(name) {
  if (!name) return;
  if (lists[name]) {
    alert("List name already exists.");
    return;
  }
  lists[name] = [];
  currentList = name;
  saveLists();
  renderListSidebar();
  renderWishlist();
}

function deleteList(name) {
  if (!lists[name]) return;
  if (!confirm(`Delete list "${name}"? This cannot be undone.`)) return;
  delete lists[name];
  const remaining = Object.keys(lists);
  currentList = remaining[0] || null;
  saveLists();
  renderListSidebar();
  renderWishlist();
}

function renameList(oldName, newName) {
  if (!newName || lists[newName]) {
    alert("Invalid or duplicate list name.");
    return;
  }
  lists[newName] = lists[oldName];
  delete lists[oldName];
  if (currentList === oldName) currentList = newName;
  saveLists();
  renderListSidebar();
}

function saveLists() {
  localStorage.setItem('wishlistLists', JSON.stringify(lists));
  localStorage.setItem('currentList', currentList);
}

function renderListSidebar() {
  const container = document.getElementById('listContainer');
  container.innerHTML = '';

  for (const name of Object.keys(lists)) {
    const div = document.createElement('div');
    div.className = 'list-item' + (name === currentList ? ' active' : '');

    const label = document.createElement('span');
    label.textContent = name;
    label.style.flex = '1';

    div.onclick = () => {
      currentList = name;
      saveLists();
      renderListSidebar();
      renderWishlist();
    };

    const menu = document.createElement('span');
    menu.className = 'list-menu';
    menu.textContent = 'â‹®';

    // âœ… TOOLTIP LOGIC (RESTORED)
    menu.onclick = (e) => {
      e.stopPropagation();

      // Remove any existing tooltip
      document.querySelectorAll('.list-tooltip').forEach(t => t.remove());

      const tooltip = document.createElement('div');
      tooltip.className = 'list-tooltip';

      tooltip.onclick = (e) => e.stopPropagation();

      const renameBtn = document.createElement('button');
      renameBtn.textContent = 'âœï¸ Rename';
      renameBtn.onclick = () => {
        const newName = prompt("Enter new list name:", name);
        renameList(name, newName);
        tooltip.remove();
      };

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'ðŸ—‘ Delete';
      deleteBtn.onclick = () => {
        deleteList(name);
        tooltip.remove();
      };

      tooltip.appendChild(renameBtn);
      tooltip.appendChild(deleteBtn);
      menu.appendChild(tooltip);

      // Close on outside click (delayed)
      setTimeout(() => {
        document.addEventListener('click', function closeMenu() {
          tooltip.remove();
          document.removeEventListener('click', closeMenu);
        });
      }, 0);
    };

    div.appendChild(label);
    div.appendChild(menu);
    container.appendChild(div);
  }
}



document.getElementById('newListBtn').onclick = () => {
  const name = prompt("Enter new list name:");
  if (name) createList(name);
};

/* ==============================
   Wishlist logic (unchanged)
============================== */
function formatPrice(num) {
  return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function addProduct(product = null) {
  if (!currentList) return alert("No list selected.");

  let link, name, price, quantity;

  if (product) {
    link = product.link;
    name = product.name;
    price = product.price;
    quantity = product.quantity || 1;
  } else {
    link = document.getElementById('productLink').value.trim();
    name = document.getElementById('productName').value.trim();
    price = parseFloat(document.getElementById('productPrice').value);
    quantity = parseInt(document.getElementById('productQuantity').value) || 1;
  }

  if (!link || !name || isNaN(price) || price < 0 || quantity < 1) {
    if (!product) alert("Please fill in all fields with valid values.");
    return;
  }

  name = name.replace(/,+$/,'');

  const wishlist = lists[currentList];
  const existing = wishlist.find(p => p.link === link);
  if (existing) {
    existing.quantity += quantity;
  } else {
    const asinMatch = link.match(/\/dp\/([A-Z0-9]{10})/) || link.match(/\/gp\/product\/([A-Z0-9]{10})/);
    let imageUrl = '';
    if (asinMatch) imageUrl = `https://images-na.ssl-images-amazon.com/images/P/${asinMatch[1]}._AC_UL320_.jpg`;
    wishlist.push({ link, name, price, quantity, imageUrl });
  }

  saveLists();
  renderWishlist();

  if (!product) {
    document.getElementById('productLink').value = '';
    document.getElementById('productName').value = '';
    document.getElementById('productPrice').value = '';
    document.getElementById('productQuantity').value = 1;
  }
}

function renderWishlist() {
  const tbody = document.getElementById('wishlistBody');
  const previewContainer = document.getElementById('previews');
  tbody.innerHTML = '';
  previewContainer.innerHTML = '';
  if (!currentList) return;

  const wishlist = lists[currentList];

  let totalPrice = 0;
  let totalQty = 0;

  wishlist.forEach(product => {
    totalPrice += product.price * product.quantity;
    totalQty += product.quantity;

    // Table row
    const row = document.createElement('tr');
    row.dataset.link = product.link;

    const nameCell = document.createElement('td');
    nameCell.textContent = product.name;

    const linkCell = document.createElement('td');
    const a = document.createElement('a');
    a.href = product.link.startsWith('http') ? product.link : 'https://' + product.link;
    a.textContent = "View Product";
    a.target = "_blank";
    linkCell.appendChild(a);

    const priceCell = document.createElement('td');
    priceCell.textContent = formatPrice(product.price);

    const qtyCell = document.createElement('td');
    const qtyInput = document.createElement('input');
    qtyInput.type = 'number';
    qtyInput.min = 1;
    qtyInput.value = product.quantity;
    qtyInput.className = 'qty-input';
    qtyInput.oninput = () => {
      const val = parseInt(qtyInput.value);
      product.quantity = isNaN(val) || val < 1 ? 1 : val;
      renderWishlist();
    };
    qtyCell.appendChild(qtyInput);

    const removeCell = document.createElement('td');
    const removeBtn = document.createElement('button');
    removeBtn.textContent = "Remove";
    removeBtn.className = "remove-btn";
    removeBtn.onclick = () => {
      lists[currentList] = wishlist.filter(p => p.link !== product.link);
      saveLists();
      renderWishlist();
    };
    removeCell.appendChild(removeBtn);

    row.appendChild(nameCell);
    row.appendChild(linkCell);
    row.appendChild(priceCell);
    row.appendChild(qtyCell);
    row.appendChild(removeCell);
    tbody.appendChild(row);

    // Preview card
    const previewDiv = document.createElement('div');
    previewDiv.className = 'preview-card';
    previewDiv.dataset.link = product.link;

    const qtyDropdown = document.createElement('select');
    qtyDropdown.className = 'qty-dropdown';
    for (let i = 1; i <= 100; i++) {
      const opt = document.createElement('option');
      opt.value = i;
      opt.textContent = i;
      if (i === product.quantity) opt.selected = true;
      qtyDropdown.appendChild(opt);
    }
    qtyDropdown.onchange = () => {
      product.quantity = parseInt(qtyDropdown.value);
      renderWishlist();
    };

    previewDiv.innerHTML = `
      ${product.imageUrl ? `<img src="${product.imageUrl}" alt="${product.name}">` : ''}
      <div>
        <strong>${product.name}</strong>
        <span>$${formatPrice(product.price)}</span>
        <a href="${product.link.startsWith('http') ? product.link : 'https://' + product.link}" target="_blank">View</a>
      </div>
    `;
    previewDiv.appendChild(qtyDropdown);
    previewContainer.appendChild(previewDiv);
  });

  document.getElementById('totalPrice').textContent = formatPrice(totalPrice);
  document.getElementById('totalQuantity').textContent = totalQty;
}

/* ==============================
   CSV Import (current list only)
============================== */
document.getElementById('importBtn').addEventListener('click', () => {
  if (!currentList) return alert("No list selected.");
  const fileInput = document.getElementById('csvFile');
  const file = fileInput.files[0];
  if (!file) return alert("Please select a CSV file.");

  const reader = new FileReader();
  reader.onload = function(e) {
    const text = e.target.result;
    const lines = text.split(/\r?\n/).filter(l => l.trim());
    if (!lines.length) return alert("CSV is empty.");

    lines.shift(); // remove header
    lines.forEach(line => {
      const [name, price, link, quantity] = line.split(',');
      if (name && price && link) {
        addProduct({ name: name.trim(), price: parseFloat(price), link: link.trim(), quantity: parseInt(quantity) || 1 });
      }
    });

    fileInput.value = '';
  };
  reader.readAsText(file);
});

/* ==============================
   CSV Export (current list only)
============================== */
document.getElementById('exportBtn').addEventListener('click', () => {
  if (!currentList) return alert("No list selected.");
  let csv = "Name,Price,Link,Quantity\n";
  lists[currentList].forEach(p => {
    csv += `"${p.name}",${p.price},"${p.link}",${p.quantity}\n`;
  });

  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${currentList}.csv`;
  a.click();
  URL.revokeObjectURL(url);
});
</script>

</body>
</html>
